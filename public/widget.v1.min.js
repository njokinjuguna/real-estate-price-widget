(()=>{(function(){let a=document.getElementById("price-api-widget");if(!a)return;let b=a.dataset.endpoint,g=a.dataset.apikey,m=(a.dataset.currency||"USD").toUpperCase(),f=a.dataset.locale||"en-US",x=a.dataset.plan||"",p=Number(a.dataset.burstCount||20);if(!b||!g){a.innerHTML='<div style="color:#ef4444">Missing <code>data-endpoint</code> or <code>data-apikey</code>.</div>';return}let h=`
    <style>
      .vs-card{display:grid; gap:14px}
      .vs-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px}
      .vs-field{display:flex; flex-direction:column; gap:6px}
      .vs-input{
        background:#0f1632; color:#eaf2ff; border:1px solid #243056; border-radius:10px; padding:10px;
        outline:none; transition: box-shadow .2s,border-color .2s;
      }
      .vs-input:focus{box-shadow:0 0 0 3px rgba(110,231,210,.25); border-color:#3aa3a1}
      .vs-row{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
      .vs-btn{
        appearance:none; border:0; border-radius:10px; padding:10px 14px; cursor:pointer; color:#0b1020;
        background:linear-gradient(135deg,#6ee7d2,#8b5cf6); font-weight:700;
      }
      .vs-btn[disabled]{opacity:.7; cursor:not-allowed}
      .vs-sub{color:#a6b5d8; font-size:.9rem}
      .vs-result{font-weight:800; font-size:1.1rem}
      .vs-error{color:#ef4444}
      .vs-tags{display:flex; gap:8px; flex-wrap:wrap}
      .vs-tag{border:1px solid #243056; color:#a6b5d8; border-radius:999px; padding:4px 8px; font-size:.8rem}
      .vs-right{margin-left:auto}
      .vs-divider{height:1px; background:#243056; margin:6px 0}
      .vs-mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;}
      .vs-badge{background:#101738;border:1px solid #243056;border-radius:999px;padding:6px 10px;color:#a6b5d8}
    </style>
  `;function w(t){try{return new Intl.NumberFormat(f,{style:"currency",currency:m}).format(Number(t))}catch{return`$${Number(t).toLocaleString()}`}}a.innerHTML=h+`
    <div class="vs-card">
      <div class="vs-row">
        <span class="vs-badge">Plan: <strong>${x||"Unknown"}</strong></span>
        <span class="vs-badge">Locale: <span class="vs-mono">${f}</span></span>
        <span class="vs-badge">Currency: <span class="vs-mono">${m}</span></span>
        <span class="vs-right"></span>
        <button id="vs-burst" class="vs-btn" title="Fire ${p} quick requests to hit the limit">Try burst (429)</button>
      </div>

      <div class="vs-grid">
        <label class="vs-field">
          <span class="vs-sub">Overall Quality (1\u201310)</span>
          <input id="vs-qual" class="vs-input" type="number" min="1" max="10" value="7">
        </label>
        <label class="vs-field">
          <span class="vs-sub">Living Area (sqft)</span>
          <input id="vs-grliv" class="vs-input" type="number" value="1710">
        </label>
        <label class="vs-field">
          <span class="vs-sub">Garage Cars</span>
          <input id="vs-gcars" class="vs-input" type="number" value="2">
        </label>
        <label class="vs-field">
          <span class="vs-sub">Basement (sqft)</span>
          <input id="vs-bsmt" class="vs-input" type="number" value="856">
        </label>
        <label class="vs-field">
          <span class="vs-sub">Year Built</span>
          <input id="vs-year" class="vs-input" type="number" value="2003">
        </label>
      </div>

      <div class="vs-row">
        <button id="vs-submit" class="vs-btn">Estimate Price</button>
        <span id="vs-status" class="vs-sub"></span>
      </div>

      <div class="vs-divider"></div>

      <div class="vs-row">
        <div id="vs-result" class="vs-result"></div>
        <div id="vs-error" class="vs-error"></div>
      </div>
      <div id="vs-tags" class="vs-tags"></div>
    </div>
  `;let e=t=>a.querySelector(t),o=e("#vs-submit"),l=e("#vs-burst"),r=e("#vs-status"),d=e("#vs-result"),c=e("#vs-error"),i=e("#vs-tags");function C(){return{OverallQual:Number(e("#vs-qual").value),GrLivArea:Number(e("#vs-grliv").value),GarageCars:Number(e("#vs-gcars").value),TotalBsmtSF:Number(e("#vs-bsmt").value),YearBuilt:Number(e("#vs-year").value)}}function $(t){i.innerHTML="";let s=t.headers.get("X-RateLimit-Limit"),u=t.headers.get("X-RateLimit-Remaining"),v=t.headers.get("Retry-After");s&&i.insertAdjacentHTML("beforeend",`<span class="vs-tag">Limit: ${s}</span>`),u&&i.insertAdjacentHTML("beforeend",`<span class="vs-tag">Remaining: ${u}</span>`),v&&i.insertAdjacentHTML("beforeend",`<span class="vs-tag">Retry-After: ${v}s</span>`)}async function y(){let t=await fetch(b,{method:"POST",headers:{"Content-Type":"application/json","api-key":g},body:JSON.stringify(C())});if($(t),t.status===429){let s=t.headers.get("Retry-After");throw new Error(`429: rate limit hit${s?` \u2014 retry in ~${s}s`:""}`)}if(t.status===401)throw new Error("401: invalid API key");if(t.status===422){let s=await t.json().catch(()=>({}));throw new Error(`422: validation error ${s?.detail?JSON.stringify(s.detail):""}`)}if(!t.ok){let s=await t.text();throw new Error(`HTTP ${t.status}: ${s}`)}return t.json()}async function L(){c.textContent="",d.textContent="",i.innerHTML="",o.disabled=!0,o.textContent="Estimating\u2026",r.textContent="Calling pricing model\u2026";try{let t=await y();d.textContent=`Estimated Price: ${w(t.predicted_price)}`,r.textContent=""}catch(t){c.textContent=t.message||String(t),r.textContent=""}finally{o.disabled=!1,o.textContent="Estimate Price"}}async function E(){c.textContent="",d.textContent="",i.innerHTML="",l.disabled=!0,l.textContent=`Bursting ${p}\u2026`,r.textContent="Firing a quick burst to demonstrate throttling\u2026";try{let t=Array.from({length:p},()=>y().then(()=>"200",n=>n.message.startsWith("429")?"429":"ERR")),s=await Promise.all(t),u=s.filter(n=>n==="200").length,v=s.filter(n=>n==="429").length,k=s.filter(n=>n==="ERR").length;d.textContent=`Burst summary \u2192 OK: ${u}, 429: ${v}, Other: ${k}`,r.textContent=""}catch(t){c.textContent=t.message||String(t),r.textContent=""}finally{l.disabled=!1,l.textContent="Try burst (429)"}}o.addEventListener("click",L),l.addEventListener("click",E)})();})();
